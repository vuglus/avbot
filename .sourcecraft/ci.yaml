on:
  push:
    - workflows: [sample-workflow]
      filter:
        branches: ["master", "main"]

workflows:
  # Sample workflow. For other options, see: https://sourcecraft.dev/portal/docs/ru/sourcecraft/ci-cd-ref/workflows
  sample-workflow:
    runs_on: compute
    tasks:
      - name: ci-task
        cubes:
          - name: setup-and-test
            image: cr.yandex/mirror/library/python:3.13.2-slim
            script:
              - python -m pip install --upgrade pip
              - if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
              - pytest -q
          - name: docker-build
            image: docker.io/library/docker:latest
            script:
              - docker build -t avbot:ci .
              - docker push avbot:ci 
          - name: deploy
            image: docker.io/library/alpine:latest
