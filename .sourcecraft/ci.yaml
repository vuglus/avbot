on:
  push:
    - workflows: [sample-workflow]
      filter:
        branches: ["master", "main"]

workflows:
  sample-workflow:
    runs_on: self-hosted # Experimental mode. For other options, see: https://sourcecraft.dev/portal/docs/ru/sourcecraft/ci-cd-ref/workflows
    tasks:
      - name: sample-task
        cubes:
          - name: sample-cube1
            image: cr.yandex/mirror/library/python:3.13.2-slim
            script:
              - python -m pip install --upgrade pip
              - if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
              - pytest -q
              - docker build -t avbot:ci .
              - docker save avbot:ci | gzip > avbot.tar.gz

